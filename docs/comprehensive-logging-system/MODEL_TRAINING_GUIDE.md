# Model Training Data Collection Guide

This guide describes how to utilize the comprehensive logging system for gathering high-quality training data for ML models.

## Overview

Our application now incorporates an enhanced logging system designed specifically for capturing detailed data that can be used to train machine learning models. The system logs user interactions, AI responses, system events, and business logic operations with rich contextual information, enabling better model training and evaluation.

## Key Components

1. **Enhanced Type Definitions**
   - Updated `logging.types.ts` with all necessary interfaces
   - Added support for automatic and neutral feedback types
   - Added data classification and retention policy fields
   
2. **Database Schema**
   - Created comprehensive tables for storing log data
   - Enhanced model_feedback table with additional feedback types
   - Implemented data retention policies and privacy controls

3. **Logging Hooks**
   - `useLogging`: Basic logging capabilities
   - `useEnhancedLogging`: Detailed contextual logging for model training
   - `useCentralizedLogging`: Central hook that integrates both systems

4. **LoggingProvider Component**
   - React context provider for app-wide logging access
   - Automatic session tracking
   - Component lifecycle logging

## Using the Logging System for Model Training

### 1. Capturing User Interactions with Context

```typescript
const { logAction } = useCentralizedLogging();

// Log a user action with detailed context
logAction(
  'button_click',
  'IdeaGenerator',
  {
    idea_id: idea.id,
    idea_title: idea.title,
    element: 'generate_button',
    step: 'initialization'
  },
  {
    training_priority: 'high',
    workflow: 'idea_generation'
  }
);
```

### 2. Logging AI Interactions

```typescript
const { logAIInteraction } = useCentralizedLogging();

// Log AI interaction for model training
logAIInteraction(
  'idea_generation',
  {
    model: 'gpt-4',
    prompt: userPrompt,
    response: aiResponse,
    tokens: 1250,
    idea_id: generatedIdea.id
  },
  {
    training_priority: 'high',
    domain: 'business_ideas'
  }
);
```

### 3. Recording Model Feedback

```typescript
const { recordModelFeedback } = useCentralizedLogging();

// Record explicit user feedback
recordModelFeedback(
  'idea-generation-model-v2',
  promptData,
  responseData,
  'positive', // or 'negative', 'correction', 'suggestion', 'automatic', 'neutral'
  { quality: 4.5, relevance: 5, creativity: 4 }
);

// Record automatic feedback based on user behavior
recordModelFeedback(
  'idea-generation-model-v2',
  promptData,
  responseData,
  'automatic',
  { 
    timeSpentViewing: 45,
    savedToFavorites: true,
    furtherRefined: true
  }
);
```

### 4. Logging Business Logic

```typescript
const { logBusinessLogic } = useCentralizedLogging();

// Log business decision points and rule applications
logBusinessLogic(
  'apply_rules',
  'idea_validation',
  {
    rules_applied: ['market_validation', 'feasibility_check'],
    decision_points: {
      market_size: 'large',
      competition: 'medium',
      feasibility: 'high'
    },
    outcome: 'approved'
  }
);
```

### 5. Logging Data Operations

```typescript
const { logDataOperation } = useCentralizedLogging();

// Log data operations for tracking data provenance
logDataOperation(
  'create',
  'ideas',
  {
    entity_id: idea.id,
    fields: ['title', 'description', 'market_size'],
    user_generated: true
  }
);
```

## Data Classification and Retention

All logged data includes classification and retention policy information:

- **Data Classification**:
  - `non_personal`: No personally identifying information
  - `pseudonymized`: Contains indirect identifiers
  - `personal`: Contains personal information
  - `sensitive`: Contains sensitive personal information

- **Retention Policies**:
  - `transient`: Deleted after processing (max 24 hours)
  - `short_term`: Kept for 30 days
  - `medium_term`: Kept for 6 months
  - `long_term`: Kept for 2 years

## Automatic Anonymization

The system automatically applies anonymization or pseudonymization based on retention policies. This ensures:

1. Model training data is properly sanitized
2. User privacy is protected
3. Regulatory compliance requirements are met

## New Database Migration Changes

We recently added support for additional feedback types to allow more nuanced model training:

- `automatic`: Feedback generated by the system based on user behavior
- `neutral`: Neither positive nor negative feedback

The migration script `20250316212000_update_model_feedback_types.sql` updates the database schema to support these new feedback types. Run it using:

```bash
node scripts/run-model-feedback-update.js
```

## Best Practices

1. **Always include context**: Add relevant business and user context to logs
2. **Respect privacy settings**: Check user consent before logging for AI training
3. **Classify data properly**: Set appropriate classification and retention policies
4. **Capture both positive and negative examples**: Log both successful and failed interactions
5. **Include timestamps**: Always include timestamps for temporal analysis
